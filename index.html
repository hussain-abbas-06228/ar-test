<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE-edge" />
    <title>GeoAR.js demo</title>
    <!-- Include proj4 library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.6.2/proj4.js"></script>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.rawgit.com/ngokevin/kframe/csstrigger/components/layout/src/index.js"></script>
  </head>

  <body>
    <a-scene
      cursor='rayOrigin: mouse; fuse: true; fuseTimeout: 0;'
      raycaster="objects: [gps-projected-entity-place];"
      vr-mode-ui="enabled: true"
      arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
    >
      <a-assets>
        <!-- Load your images and icons here -->
        <img id="concessions-icon" src="assets/menu.png" crossorigin="anonymous">
        <img id="friends-icon" src="assets/friends.png" crossorigin="anonymous">
        <img id="hospitality-icon" src="assets/hospitality.png" crossorigin="anonymous">
        <img id="participants-icon" src="assets/participants.png" crossorigin="anonymous">
      </a-assets>

      <a-camera gps-camera rotation-reader></a-camera>

      <!-- Function to open a URL in a new window -->
      <script>
        function openURLInNewWindow(url) {
          window.open(url, '_blank');
        }
      </script>

      <!-- Calculate distance and update text element -->
      <script>
        function latLonToMeters(userLatitude, userLongitude, destLatitude, destLongitude) {
          const wgs84 = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs";
          const webMercator = "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs";

          // Project the user's latitude and longitude to meters
          const userCoords = proj4(wgs84, webMercator, [userLongitude, userLatitude]);

          // Project the destination's latitude and longitude to meters
          const destCoords = proj4(wgs84, webMercator, [destLongitude, destLatitude]);

          // Calculate the distance between user and destination
          const deltaX = destCoords[0] - userCoords[0];
          const deltaY = destCoords[1] - userCoords[1];
          const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

          return distance;
        }

        function updateDistanceText(locationEl, distance) {
          const distanceTextEl = locationEl.querySelector('.distance-text');
          distanceTextEl.setAttribute('value', 'Distance: ' + distance.toFixed(2) + ' meters');
        }

        function calculateAndDisplayDistance(locationEl, userLatitude, userLongitude, destLatitude, destLongitude) {
          const distance = latLonToMeters(userLatitude, userLongitude, destLatitude, destLongitude);
          updateDistanceText(locationEl, distance);
        }
      </script>

      <!-- Location for Concessions -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"
      >
        <!-- Concessions Icon -->
        <a-image src="#concessions-icon" onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"></a-image>
        <!-- Name of Establishment -->
        <a-text position="-1 1 0" value="Concessions Name"></a-text>
        <!-- Distance from User -->
        <a-text class="distance-text" position="-1 -1 0" value="Distance: 0 meters"></a-text>
      </a-entity>

      <script>
        calculateAndDisplayDistance(
          document.querySelector('[gps-entity-place]'),
          24.855041,
          67.024227
        );
      </script>

      <!-- Location for Friends -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"
      >
        <!-- Friends Icon -->
        <a-image src="#friends-icon" onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"></a-image>
        <!-- Name of Friend -->
        <a-text position="-1 1 0" value="Friend's Name"></a-text>
        <!-- Distance from User -->
        <a-text class="distance-text" position="-1 -1 0" value="Distance: 0 meters"></a-text>
      </a-entity>

      <script>
        calculateAndDisplayDistance(
          document.querySelectorAll('[gps-entity-place]')[1],
          24.853982,
          67.024771
        );
      </script>

      <!-- Location for Hospitality -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
      >
        <!-- Hospitality Icon -->
        <a-image src="#hospitality-icon"></a-image>
        <!-- Type of Location (e.g., Restroom) -->
        <a-text position="-1 1 0" value="Restroom"></a-text>
        <!-- Distance from User -->
        <a-text class="distance-text" position="-1 -1 0" value="Distance: 0 meters"></a-text>
      </a-entity>

      <!-- Location for Participants -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"
      >
        <!-- Participants Icon -->
        <a-image src="#participants-icon" onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"></a-image>
        <!-- Name of Participant -->
        <a-text position="-1 1 0" value="Participant's Name"></a-text>
        <!-- Distance from User -->
        <a-text class="distance-text" position="-1 -1 0" value="Distance: 0 meters"></a-text>
      </a-entity>

      <script>
        calculateAndDisplayDistance(
          document.querySelectorAll('[gps-entity-place]')[3],
          24.855889,
          67.026156
        );
      </script>
    </a-scene>
  </body>
</html>
