<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE-edge" />
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.rawgit.com/ngokevin/kframe/csstrigger/components/layout/src/index.js"></script>
  </head>

  <body>
    <a-scene
      cursor='rayOrigin: mouse; fuse: true; fuseTimeout: 0;'
      raycaster="objects: [gps-projected-entity-place];"
      vr-mode-ui="enabled: true"
      arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
    >
      <a-assets>
        <!-- Load your images and icons here -->
        <img id="concessions-icon" src="assets/menu.png" crossorigin="anonymous">
        <img id="friends-icon" src="assets/friends.png" crossorigin="anonymous">
        <img id="hospitality-icon" src="assets/hospitality.png" crossorigin="anonymous">
        <img id="participants-icon" src="assets/participants.png" crossorigin="anonymous">
      </a-assets>

      <a-camera gps-camera rotation-reader></a-camera>

      <!-- Function to open a URL in a new window -->
      <script>
        function openURLInNewWindow(url) {
          window.open(url, '_blank');
        }
      </script>

      <!-- Function to calculate and display the distance -->
      <script>
        function calculateAndDisplayDistance(locationEntity, locationLat, locationLon) {
          const camera = document.querySelector('[gps-camera]');
          const distanceText = locationEntity.querySelector('.distance-text');
          const location = locationEntity.querySelector('[gps-entity-place]');

          location.addEventListener('gps-entity-place-added', () => {
            const check = setInterval(() => {
              const cameraPosition = camera.getAttribute('position');
              const userLocation = new THREE.Vector3(
                cameraPosition.x,
                cameraPosition.y,
                cameraPosition.z
              );
              const locationPosition = location.getAttribute('position');
              const targetLocation = new THREE.Vector3(
                locationPosition.x,
                locationPosition.y,
                locationPosition.z
              );
              const distance = userLocation.distanceTo(targetLocation);

              // Update the displayed distance in the text element
              distanceText.setAttribute('value', 'Distance: ' + distance.toFixed(2) + ' meters');
            }, 100);

            location.addEventListener('gps-entity-place-removed', () => {
              clearInterval(check);
            });
          });
        }
      </script>

      <!-- Location for Concessions -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        gps-entity-place="latitude: 24.855041; longitude: 67.024227;"
        onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"
      >
        <!-- Concessions Icon -->
        <a-image src="#concessions-icon" onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"></a-image>
        <!-- Name of Establishment -->
        <a-text position="-1 1 0" value="Concessions Name"></a-text>
        <!-- Distance from User -->
        <a-text class="distance-text" position="-1 -1 0" value="Distance: 0 meters"></a-text>
      </a-entity>

      <!-- Calculate and display distance for Concessions -->
      <script>
        calculateAndDisplayDistance(document.querySelector('[gps-entity-place]'), 24.855041, 67.024227);
      </script>

      <!-- Location for Friends -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        gps-entity-place="latitude: 24.853982; longitude: 67.024771;"
        onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"
      >
        <!-- Friends Icon -->
        <a-image src="#friends-icon" onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"></a-image>
        <!-- Name of Friend -->
        <a-text position="-1 1 0" value="Friend's Name"></a-text>
        <!-- Distance from User -->
        <a-text class="distance-text" position="-1 -1 0" value="Distance: 0 meters"></a-text>
      </a-entity>

      <!-- Calculate and display distance for Friends -->
      <script>
        calculateAndDisplayDistance(document.querySelectorAll('[gps-entity-place]')[1], 24.853982, 67.024771);
      </script>

      <!-- Location for Hospitality -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        gps-entity-place="latitude: 24.854645; longitude: 67.027000;"
      >
        <!-- Hospitality Icon -->
        <a-image src="#hospitality-icon"></a-image>
        <!-- Type of Location (e.g., Restroom) -->
        <a-text position="-1 1 0" value="Restroom"></a-text>
        <!-- Distance from User -->
        <a-text class="distance-text" position="-1 -1 0" value="Distance: 0 meters"></a-text>
      </a-entity>

      <!-- Calculate and display distance for Hospitality -->
      <script>
        calculateAndDisplayDistance(document.querySelectorAll('[gps-entity-place]')[2], 24.854645, 67.027000);
      </script>

      <!-- Location for Participants -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        gps-entity-place="latitude: 24.855889; longitude: 67.026156;"
        onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"
      >
        <!-- Participants Icon -->
        <a-image src="#participants-icon" onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"></a-image>
        <!-- Name of Participant -->
        <a-text position="-1 1 0" value="Participant's Name"></a-text>
        <!-- Distance from User -->
        <a-text class="distance-text" position="-1 -1 0" value="Distance: 0 meters"></a-text>
      </a-entity>

      <!-- Calculate and display distance for Participants -->
      <script>
        calculateAndDisplayDistance(document.querySelectorAll('[gps-entity-place]')[3], 24.855889, 67.026156);
      </script>
    </a-scene>
  </body>
</html>
