<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE-edge" />
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.rawgit.com/ngokevin/kframe/csstrigger/components/layout/src/index.js"></script>
  </head>

  <body>
    <a-scene
      cursor='rayOrigin: mouse; fuse: true; fuseTimeout: 0;'
      raycaster="objects: [gps-projected-entity-place];"
      vr-mode-ui="enabled: true"
      arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
    >
      <a-assets>
        <!-- Load your images and icons here -->
        <img id="concessions-icon" src="assets/menu.png" crossorigin="anonymous">
        <img id="friends-icon" src="assets/friends.png" crossorigin="anonymous">
        <img id="hospitality-icon" src="assets/hospitality.png" crossorigin="anonymous">
        <img id="participants-icon" src="assets/participants.png" crossorigin="anonymous">
      </a-assets>

      <a-camera gps-camera rotation-reader></a-camera>

      <!-- Function to open a URL in a new window -->
      <script>
        function openURLInNewWindow(url) {
          window.open(url, '_blank');
        }
      </script>

      <!-- Function to calculate and display distance -->
      <script>
        window.addEventListener('load', () => {
          const camera = document.querySelector('[camera]');
          const marker = document.querySelector('[gps-entity-place]');
          let check;

          marker.addEventListener('markerFound', () => {
            let cameraPosition = camera.object3D.position;
            let markerPosition = marker.object3D.position;
            let distance = cameraPosition.distanceTo(markerPosition);

            check = setInterval(() => {
              cameraPosition = camera.object3D.position;
              markerPosition = marker.object3D.position;
              distance = cameraPosition.distanceTo(markerPosition);

              // Display the distance on the screen
              const distanceText = document.querySelector('#distance-text');
              distanceText.setAttribute('value', `Distance from user: ${distance.toFixed(2)} meters`);
            }, 100);
          });

          marker.addEventListener('markerLost', () => {
            clearInterval(check);
          });
        });
      </script>

      <!-- Location for Concessions -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        gps-entity-place="latitude: 24.855041; longitude: 67.024227;"
        onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"
      >
        <!-- Concessions Icon -->
        <a-image src="#concessions-icon" onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"></a-image>
        <!-- Name of Establishment -->
        <a-text position="-1 1 0" value="Concessions Name"></a-text>
        <!-- Display Distance from User -->
        <a-text id="distance-text" position="-1 -1 0" value="Distance from user: DISTANCE"></a-text>
      </a-entity>

      <!-- Location for Friends -->
      <a-entity
        layout="type: line; margin: 0.5"
        look-at="[gps-camera]"
        scale="50 50 50"
        gps-entity-place="latitude: 24.853982; longitude: 67.024771;"
        onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"
      >
        <!-- Friends Icon -->
        <a-image src="#friends-icon" onclick="openURLInNewWindow('https://ar-js-org.github.io/AR.js-Docs/')"></a-image>
        <!-- Name of Friend -->
        <a-text position="-1 1 0" value="Friend's Name"></a-text>
        <!-- Display Distance from User -->
        <a-text id="distance-text" position="-1 -1 0" value="Distance from user: DISTANCE"></a-text>
      </a-entity>
    </a-scene>
  </body>
</html>
